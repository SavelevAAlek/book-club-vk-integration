# Архитектура модуля интеграции с социальными сетями

## Обзор проекта

Курсовой проект представляет собой веб-приложение "Книжный клуб" с модулем интеграции с социальной сетью ВКонтакте. Проект демонстрирует основные принципы интеграции с внешними API и OAuth авторизацией.

## Структура проекта

```
book-social-integration/
├── server.js                 # Основной файл сервера
├── package.json             # Зависимости проекта
├── README.md               # Описание проекта
├── VK_SETUP.md             # Инструкция по настройке ВК
├── env.example             # Пример переменных окружения
├── config/
│   └── passport.js         # Настройка Passport.js для ВК
├── modules/
│   └── vkIntegration.js    # Модуль интеграции с ВК API
├── routes/
│   ├── auth.js            # Маршруты авторизации
│   ├── books.js           # Маршруты для работы с книгами
│   └── api.js             # API маршруты для интеграции
├── views/                 # HTML шаблоны
│   ├── index.ejs         # Главная страница
│   ├── login.ejs         # Страница входа
│   ├── dashboard.ejs     # Личный кабинет
│   ├── books.ejs         # Каталог книг
│   ├── review.ejs        # Форма отзыва
│   └── error.ejs         # Страница ошибки
└── public/               # Статические файлы
    ├── css/
    │   └── style.css     # Стили приложения
    └── js/
        └── main.js       # JavaScript функционал
```

## Технологический стек

### Backend
- **Node.js** - серверная платформа
- **Express.js** - веб-фреймворк
- **Passport.js** - библиотека для аутентификации
- **passport-vkontakte** - стратегия для ВКонтакте
- **express-session** - управление сессиями
- **axios** - HTTP клиент для API запросов

### Frontend
- **EJS** - шаблонизатор
- **CSS3** - стилизация с современными возможностями
- **JavaScript (ES6+)** - клиентская логика
- **Font Awesome** - иконки

### Интеграции
- **VK API** - API ВКонтакте для авторизации и публикации
- **OAuth 2.0** - протокол авторизации

## Архитектурные компоненты

### 1. Модуль авторизации (config/passport.js)
```javascript
// Настройка стратегии ВКонтакте
passport.use(new VKontakteStrategy({
  clientID: process.env.VK_APP_ID,
  clientSecret: process.env.VK_APP_SECRET,
  callbackURL: process.env.VK_CALLBACK_URL
}, callback));
```

**Функции:**
- Настройка OAuth стратегии для ВКонтакте
- Обработка callback'ов авторизации
- Сериализация/десериализация пользователей

### 2. Модуль интеграции с ВК (modules/vkIntegration.js)
```javascript
class VKIntegration {
  constructor(accessToken) {
    this.accessToken = accessToken;
  }
  
  async getUserInfo() { /* ... */ }
  async postToWall(message) { /* ... */ }
  async shareBook(bookTitle, bookAuthor, review) { /* ... */ }
}
```

**Функции:**
- Получение информации о пользователе
- Публикация записей на стену
- Получение списка друзей
- Специализированные методы для книг и отзывов

### 3. Маршруты приложения

#### Авторизация (routes/auth.js)
- `GET /login` - страница входа
- `GET /auth/vk` - инициация авторизации ВК
- `GET /auth/vk/callback` - обработка callback'а
- `GET /logout` - выход из системы

#### Книги (routes/books.js)
- `GET /dashboard` - личный кабинет пользователя
- `GET /books` - каталог всех книг
- `POST /books/:id/add` - добавление книги в прочитанные
- `POST /books/:id/remove` - удаление книги
- `GET /books/:id/review` - форма отзыва
- `POST /books/:id/review` - сохранение отзыва

#### API (routes/api.js)
- `POST /api/share/book/:id` - поделиться книгой в ВК
- `POST /api/share/review/:id` - поделиться отзывом в ВК
- `GET /api/vk/user` - получить информацию о пользователе ВК
- `GET /api/vk/friends` - получить список друзей

## Потоки данных

### 1. Авторизация пользователя
```
Пользователь → /auth/vk → ВКонтакте → /auth/vk/callback → /dashboard
```

### 2. Добавление книги
```
Пользователь → /books → POST /books/:id/add → Обновление userBooks → /dashboard
```

### 3. Публикация в ВК
```
Пользователь → Кнопка "Поделиться" → AJAX запрос → VK API → Уведомление
```

## Безопасность

### 1. Аутентификация
- Использование сессий для отслеживания пользователей
- Проверка авторизации через middleware `isAuthenticated`
- Безопасное хранение токенов доступа

### 2. Валидация данных
- Проверка входных параметров
- Санитизация пользовательского ввода
- Обработка ошибок API

### 3. Переменные окружения
- Хранение чувствительных данных в `.env`
- Использование примеров конфигурации
- Защита от случайной публикации ключей

## Расширяемость

### 1. Добавление новых социальных сетей
```javascript
// Пример для Facebook
passport.use(new FacebookStrategy({
  clientID: process.env.FB_APP_ID,
  clientSecret: process.env.FB_APP_SECRET,
  callbackURL: process.env.FB_CALLBACK_URL
}, callback));
```

### 2. Интеграция с базой данных
```javascript
// Замена временного хранилища на MongoDB/PostgreSQL
const Book = require('./models/Book');
const User = require('./models/User');
```

### 3. Добавление новых функций
- Система рекомендаций книг
- Социальные функции (друзья, подписки)
- Уведомления о новых книгах
- Интеграция с другими сервисами

## Производительность

### 1. Кэширование
- Кэширование данных пользователя
- Кэширование списка книг
- Кэширование API ответов

### 2. Оптимизация
- Ленивая загрузка изображений
- Минификация CSS/JS
- Сжатие ответов сервера

## Мониторинг и логирование

### 1. Логирование
```javascript
console.log('Пользователь авторизован:', user.username);
console.error('Ошибка API ВК:', error);
```

### 2. Мониторинг
- Отслеживание ошибок авторизации
- Мониторинг API запросов
- Статистика использования функций

## Заключение

Проект демонстрирует современные подходы к разработке веб-приложений с интеграцией внешних сервисов. Архитектура позволяет легко расширять функционал и добавлять новые интеграции, сохраняя при этом читаемость и поддерживаемость кода.
